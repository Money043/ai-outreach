<link rel="stylesheet" href="/frontend/style.css">

<div class="nav">
  <div class="logo">rech.ai</div>
</div>

<div class="container">

  <h2>Connect your email</h2>

  <input id="sender" placeholder="Your email (e.g. you@company.com)">
  <input id="login" placeholder="Brevo SMTP Login">
  <input id="pass" type="password" placeholder="Brevo SMTP Key">

  <button onclick="connect()">Connect Email</button>

  <hr style="margin:30px 0">

  <h2>Upload Leads</h2>
  <input type="file" id="file">
  <button onclick="upload()">Upload</button>

  <hr style="margin:30px 0">

  <h2>Start Outreach</h2>
  <button onclick="start()">Start Campaign</button>

  <p id="status"></p>

</div>

<script>
async function connect(){
  const sender = encodeURIComponent(document.getElementById("sender").value);
  const login = encodeURIComponent(document.getElementById("login").value);
  const pass = encodeURIComponent(document.getElementById("pass").value);

  const res = await fetch(`/connect-email?sender_email=${sender}&brevo_login=${login}&brevo_password=${pass}`, {
    method: "POST",
    headers: { "Authorization": "Bearer " + localStorage.token }
  });

  const data = await res.json();
  alert(data.message || "Connected");
}

async function upload(){
  const fd = new FormData();
  fd.append("file", file.files[0]);

  const res = await fetch("/upload", {
    method: "POST",
    headers: { "Authorization": "Bearer " + localStorage.token },
    body: fd
  });

  const data = await res.json();
  status.innerText = data.message;
}

async function start(){
  const res = await fetch("/start-campaign", {
    method: "POST",
    headers: { "Authorization": "Bearer " + localStorage.token }
  });
  const data = await res.json();
  status.innerText = data.message;
}
</script>
